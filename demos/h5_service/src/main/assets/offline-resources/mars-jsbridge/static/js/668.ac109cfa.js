(window.webpackChunkjsbridge_example=window.webpackChunkjsbridge_example||[]).push([[668],{2668:function(e,t,i){"use strict";i.d(t,{Z:function(){return N}});var a,s=i(64659),n=i(4730),r=i(73989),l=i(75663),c=i(48214),o=i(75630),u=i(51119);!function(e){e[e.Failure=0]="Failure",e[e.Success=1]="Success",e[e.Unauthorized=-1]="Unauthorized",e[e.NotExist=-2]="NotExist"}(a||(a={}));function v(e){return N.call("x.getAppInfo",{},e)}function h(e,t){return N.call("x.getStorageItem",t,e)}function d(e,t){return N.call("x.setStorageItem",t,e)}function p(e,t){return N.call("x.removeStorageItem",t,e)}function f(e,t){return N.call("x.checkPermission",t,e)}function g(e,t){return N.call("x.makePhoneCall",t,e)}function m(e,t){return N.call("x.screenshot",t,e)}function b(e){return N.on("x.screenOrientation",e,!1)}function k(e){return N.call("x.scanCode",{},e)}function _(e,t){return N.call("x.request",t,e)}function M(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var i,a=(0,o.Z)(e);if(t){var s=(0,o.Z)(this).constructor;i=Reflect.construct(a,arguments,s)}else i=a.apply(this,arguments);return(0,c.Z)(this,i)}}var y="1.0.0",I="undefined"!==typeof window?window:{};function S(){var e,t,i,a,s;return null!==I&&void 0!==I&&null!==(e=I.JSBridge)&&void 0!==e&&e._invokeMethod?s=I.JSBridge._invokeMethod:null!==I&&void 0!==I&&null!==(t=I.JS2NativeBridge)&&void 0!==t&&t.call?s=function(e){return I.JS2NativeBridge.call(e.func,JSON.stringify(e))}:null!==(i=I.webkit)&&void 0!==i&&null!==(a=i.messageHandlers)&&void 0!==a&&a.callMethodParams?s=function(e){return I.webkit.messageHandlers.callMethodParams.postMessage(e)}:I.callMethodParams&&(s=function(e){return I.callMethodParams(e.func,e)}),s}function F(){var e,t,i,a,s;return null!==I&&void 0!==I&&null!==(e=I.JSBridge)&&void 0!==e&&e.on?s=I.JSBridge.on:null!==I&&void 0!==I&&null!==(t=I.JS2NativeBridge)&&void 0!==t&&t.on?s=function(e){var t={JSSDK:y,__msg_type:"event",__callback_id:e,func:e};I.JS2NativeBridge.on(e,JSON.stringify(t))}:null!==I&&void 0!==I&&null!==(i=I.webkit)&&void 0!==i&&null!==(a=i.messageHandlers)&&void 0!==a&&a.onMethodParams?s=function(e){var t={JSSDK:y,__msg_type:"event",__callback_id:e,func:e};I.webkit.messageHandlers.onMethodParams.postMessage(t)}:I.onMethodParams&&(s=function(e){var t={JSSDK:y,__msg_type:"event",__callback_id:e,func:e};return I.onMethodParams(e,t)}),s}var P=new(function(e){(0,l.Z)(i,e);var t=M(i);function i(){var e;return(0,s.Z)(this,i),e=t.call(this,{version:y,nativeMethodInvoker:S(),nativeEventListener:F(),listenNativeEvent:!0}),(0,u.Z)((0,r.Z)(e),"publicApi",void 0),e.publicApi={call:e.call.bind((0,r.Z)(e)),on:e.subscribe.bind((0,r.Z)(e)),off:e.unsubscribe.bind((0,r.Z)(e)),_fetchQueue:e.fetchJavaScriptMessageQueue.bind((0,r.Z)(e)),_handleMessageFromApp:e.handleMessageFromNative.bind((0,r.Z)(e)),getAppInfo:v,setStorageItem:d,getStorageItem:h,removeStorageItem:p,checkPermission:f,makePhoneCall:g,screenshot:m,screenOrientation:b,scanCode:k,request:_},e}return(0,n.Z)(i,[{key:"subscribe",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return this.publicApi.call("x.subscribeEvent",{eventName:e,timestamp:(new Date).getTime()},null),this.publicApi.call(e,{},null),this.on(e,t,i)}},{key:"unsubscribe",value:function(e,t){this.off(e,t)}},{key:"exposePublicApiToGlobal",value:function(){I.JSBridge=Object.assign(I.JSBridge||{},this.publicApi),I.Native2JSBridge=Object.assign(I.Native2JSBridge||{},this.publicApi)}}]),i}(function(){function e(t){(0,s.Z)(this,e),this.nativeMethodInvoker=void 0,this.nativeEventListener=void 0,this.scheme=void 0,this.dispatchMessagePath=void 0,this.setResultPath=void 0,this.listenNativeEvent=void 0,this.callbackId=void 0,this.callbackMap=void 0,this.eventMap=void 0,this.javascriptMessageQueue=void 0,this.dispatchMessageIFrame=null,this.setResultIFrame=null,this.dispatchMessageIFrameId=void 0,this.setResultIFrameId=void 0,this.callbackProcessor=void 0,this.version=void 0,this.version=(null===t||void 0===t?void 0:t.version)||"2.0.0",this.nativeMethodInvoker=null===t||void 0===t?void 0:t.nativeMethodInvoker,this.nativeEventListener=null===t||void 0===t?void 0:t.nativeEventListener,this.scheme=(null===t||void 0===t?void 0:t.scheme)||"nativeapp://",this.dispatchMessagePath=(null===t||void 0===t?void 0:t.dispatchMessagePath)||"dispatch_message/",this.setResultPath=(null===t||void 0===t?void 0:t.setResultPath)||"private/setresult/SCENE_FETCHQUEUE",this.dispatchMessageIFrameId=(null===t||void 0===t?void 0:t.dispatchMessageIFrameId)||"__JSBridgeIframe__",this.setResultIFrameId=(null===t||void 0===t?void 0:t.setResultIFrameId)||"__JSBridgeIframe_SetResult__",this.listenNativeEvent=!0===(null===t||void 0===t?void 0:t.listenNativeEvent),this.callbackId=1023,this.callbackMap={},this.eventMap={},this.javascriptMessageQueue=[],this.callbackProcessor=null===t||void 0===t?void 0:t.callbackProcessor}return(0,n.Z)(e,[{key:"call",value:function(e,t,i){var a,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.version,n=this.version;if(e&&"string"===typeof e){"object"!==typeof t&&(t={}),"string"===typeof s?n=s||this.version:"object"===typeof s&&(a=null===s||void 0===s?void 0:s.namespace,n=s.sdkVersion||this.version);var r={func:e,params:t,JSSDK:n,__msg_type:"call",namespace:a};if("function"===typeof i){var l=this.registerCallback(e,i);r.__callback_id=l}window.parent!==window&&(r.__iframe_url=window.location.href),this.sendMessageToNative(r)}}},{key:"on",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!e||"string"!==typeof e||"function"!==typeof t)return"";var a=this.registerCallback(e,t);return this.eventMap[e]=this.eventMap[e]||{},this.eventMap[e][a]={once:i},this.listenNativeEvent&&(this.nativeEventListener?this.nativeEventListener(e):this.call("addEventListener",{name:e},null,{sdkVersion:1})),a}},{key:"once",value:function(e,t){return this.on(e,t,!0)}},{key:"callUnsubscribe",value:function(e,t){0===Object.keys(e).length&&this.call("x.unsubscribeEvent",{eventName:t},null)}},{key:"off",value:function(e,t){if(!e||"string"!==typeof e)return!0;var i=this.eventMap[e];return!i||"object"!==typeof i||!i.hasOwnProperty(t)||(this.deregisterCallback(t),delete i[t],this.callUnsubscribe(i,e),!0)}},{key:"trigger",value:function(e,t){return this.handleMessageFromNative({__msg_type:"event",__params:t,__event_id:e})}},{key:"handleMessageFromNative",value:function(e){var t=this,i=e,a=String(i.__callback_id);if(this.callbackProcessor&&"function"===typeof this.callbackProcessor){var s=((null===this||void 0===this?void 0:this.callbackMap[a])||{}).method;this.callbackProcessor(i,s)}var n=i.__params,r=String(i.__event_id||""),l=i.__msg_type;this.callbackMap[a]?l="callback":this.eventMap[a]&&(l="event",r=r||a);var c={__err_code:"cb404"};switch(l){case"callback":var o=((null===this||void 0===this?void 0:this.callbackMap[a])||{}).callback;"function"===typeof o&&(c=o(n)),this.deregisterCallback(a);break;case"event":var u=this.eventMap[r];u&&"object"===typeof u&&Object.keys(u).forEach((function(e){var i=((null===t||void 0===t?void 0:t.callbackMap[e])||{}).callback,a=u[e];"function"===typeof i&&(c=i(n)),null!==a&&void 0!==a&&a.once&&(t.deregisterCallback(e),delete u[e],t.callUnsubscribe(u,r))}))}return c}},{key:"fetchJavaScriptMessageQueue",value:function(){var e=JSON.stringify(this.javascriptMessageQueue),t=btoa(unescape(encodeURIComponent(e)));return this.setResultIFrame&&this.javascriptMessageQueue.length>0&&(this.setResultIFrame.src="".concat(this.scheme).concat(this.setResultPath,"&").concat(t)),this.javascriptMessageQueue.splice(0,this.javascriptMessageQueue.length),e}},{key:"sendMessageToNative",value:function(e){if("1"!==String(e.JSSDK)&&this.nativeMethodInvoker){var t=this.nativeMethodInvoker(e);if(t){var i=JSON.parse(t);this.handleMessageFromNative(i)}}else this.javascriptMessageQueue.push(e),this.dispatchMessageIFrame||this.tryCreateIFrames(),this.dispatchMessageIFrame&&(this.dispatchMessageIFrame.src="".concat(this.scheme).concat(this.dispatchMessagePath))}},{key:"registerCallback",value:function(e,t){var i=String(this.callbackId++);return this.callbackMap[i]={method:e,callback:t},i}},{key:"deregisterCallback",value:function(e){delete this.callbackMap[e]}},{key:"tryCreateIFrames",value:function(){this.dispatchMessageIFrame=this.createIFrame(this.dispatchMessageIFrameId),this.setResultIFrame=this.createIFrame(this.setResultIFrameId)}},{key:"createIFrame",value:function(e){var t=document.getElementById(e);return t&&"IFRAME"===t.tagName||((t=document.createElement("iframe")).style.display="none",t.id=e,document.documentElement.appendChild(t)),t}}]),e}()));P.exposePublicApiToGlobal();var N=P.publicApi}}]);
//# sourceMappingURL=668.ac109cfa.js.map